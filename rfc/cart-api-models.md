# Data Models

| Issue | Status |
| ----- | ------ |
| #88   | Draft  |

There are two data models required for Cart API: `Cart` and `CartItem`. They are
designed in the way that allows multiple types of entity in a single `Cart`.

## `Cart`
| Property | Type | Description |
| --- | --- | --- |
| `id` | UUID | Cart ID, auto-generated by the web API | - |
| `user_id` | UUID | The ID of the user that creates the collection<sup>1</sup> |
| `cart_name` | `str` | Cart Name<sup>2</sup> |
| `default_cart` | `bool` | Flag to indicate whether this cart is the default one for a corresponding user<sup>3</sup> |
| `collection_id` | UUID | DSS Collection ID (added 2018-12-17) |

1. Use the subject of the JWT according to [the authentication flow RFC](https://allspark.dev.data.humancellatlas.org/dcp-ops/docs/wikis/RFC:-Authentication-Flow#given-a-decoded-token-what-can-we-use-as-user-identifier).
2. If `NULL`, the cart is the default one for a corresponding user.
3. `False` by default

For the details on the default cart, see `GET /resources/carts/{id}` in the proposal for the API spec.

## `CartItem`
| Property | Type | Description |
| --- | --- | --- |
| `id` | `str` | Cart Item ID* |
| `cart_id` | UUID | Associated `Cart.id` |
| `entity_id` | UUID | Entity ID |
| `entity_type` | `str` | Entity Type |
| `bundle_uuid` | UUID | Bundle ID |
| `bundle_version` | `str` | Bundle Version |

> Cart Item ID is a hash string of the combination of `cart_id`, `entity_id`, `bundle_uuid`, `bundle_version`. The hash algorithm is probably `sha256` but it is not finalized.

Change Logs:
* `CartItemBatchJob` is dropped as the actual implementation uses AWS Step Functions for long-running batch operation.
